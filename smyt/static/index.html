<!DOCTYPE html>
<html>
  <head>
    <title>Bootstrap 101 Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">

    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
  </head>
  <body>

  <div class="row" style="margin: auto; position: absolute; left: 0; right: 0; top: 0; bottom: 0">
      <h2> </h2>
        <div class="span2">
        <ul class="nav nav-tabs nav-stacked" id="models">
        </ul>
        </div>
        <div class="span10">
            <table class="table table-bordered" id="datatab"></table>
            <p id="#log"></p>
        </div>      
  </div>
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="js/bootstrap.min.js"></script>
      <script type="text/javascript">
          function loadTable(name){
              $.get('/api/'+name+'/', {'format':'json'}, onGetTable);
              };

          function onDataClick(caller)
          {
            var a = $(caller)
            var data  = a.data();
            $(caller).replaceWith('<input id=' + caller.id + ' />');
            var input = $('input#'+caller.id)
            input.val(a.text());
            input.data(data);
            var dd = input.data();
            if (dd.type=='date'){
            input.datepicker({dateFormat: "yy-mm-dd"});
            };

            var aa = $('<a/>')
            .text('Сохранить')
            .attr('onclick','onSave("' + 'input#'+caller.id+'");')
            .attr('href','#')
            .appendTo(input.parent());
          }

          function onSave(input)
            {
                var input = $(input);
                var data = input.data();
                var result = true
                if (data.type == 'int')
                {
                input.val().replace(/[^0-9]/g,
                function(str) { input.parent().parent().addClass('error'); result = false});
                result=result;
                }
                if (result)
                {
                $.post('/api/'+data.model+'/' + data.id+'/', {'format':'json',
                                                              'id': data.id,
                                                              'field': data.field,
                                                              'value': input.val()}, onGetTable);;
                                                              }

            }

          function onGetTable(data){
              var table = $('#datatab');
              table.html('');
              var row = $('<tr />').appendTo(table);
              for (key in data[0]){
                  var td = $('<td/>')
                  .text(data[0][key].title)
                  .appendTo(row);};
              
              $(data[1]).each(function(index, item){
                  var row = $('<tr />').appendTo(table);
                  for (key in item){
                      var td = $('<td/>')
                      .appendTo(row);
                      if (key!='id')
                      {
                      var aa = $('<a/>')
                      .text(item[key])
                      .attr('onclick','onDataClick(this);')
                      .attr('href','#')
                      .attr('id', key + '-' +item['id'])
                      .appendTo(td);
                      aa.data(data[0][key]);
                      aa.data('id', item['id']);
                      aa.data('field', key);
                      }
                      else
                      {
                      td.text(item[key])
                      }
                      };

              }); 
          };
          function onGetModels(data){
              var cList = $('ul#models');
              $(data).each(function(index, item){ 
                  var li = $('<li/>')
                  .appendTo(cList);
                  var aaa = $('<a/>')
                  .attr('onclick','loadTable("'+item+'");')
                  .attr('href','#')
                  .text(item)
                  .appendTo(li);
              });
              
              };
          $(document).ready(function(){$.get('/api/',{}, onGetModels)});

      </script>        
  </body>
</html>